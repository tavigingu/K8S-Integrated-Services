# Încărcăm modulele necesare
LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule headers_module modules/mod_headers.so
LoadModule log_config_module modules/mod_log_config.so

# Configurăm serverul
ServerName localhost
Listen 99

# Configurăm reverse proxy
<VirtualHost *:99>
    ServerName localhost

    # Proxy pentru toate cererile către aplicația Go pe portul 8080
    ProxyPreserveHost On
    ProxyPass / http://localhost:8080/
    ProxyPassReverse / http://localhost:8080/

    # Suport pentru WebSocket
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule /(.*) ws://localhost:8080/$1 [P,L]

    # Setăm headere echivalente cu cele din Nginx
    RequestHeader set X-Real-IP "%{REMOTE_ADDR}e"
    RequestHeader append X-Forwarded-For "%{REMOTE_ADDR}e"
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set Host "%{HTTP_HOST}e"

    # Loguri
    ErrorLog /dev/stderr
    CustomLog /dev/stdout combined
</VirtualHost>
